<addon id="plugin.video.stalkervod.tmdb" name="Stalker VOD Client + TMDB" version="0.2.0" provider-name="ReichiMD">
	<requires>
		<import addon="xbmc.python" version="3.0.1"/>
		<import addon="script.module.requests" version="2.27.1"/>
	</requires>
	<extension point="xbmc.python.pluginsource" library="addon_entry.py">
		<provides>video</provides>
	</extension>
	<extension point="xbmc.service" library="service_entry.py"/>
	<extension point="xbmc.addon.metadata">
		<reuselanguageinvoker>true</reuselanguageinvoker>
		<platform>all</platform>
		<summary lang="en_GB">Stalker VOD Client with TMDB metadata</summary>
		<description lang="en_GB">Kodi Stalker client for accessing on demand videos and channels from Stalker middleware. Extended with TMDB metadata (posters, fanart, ratings).</description>
		<license>GPL-3.0-or-later</license>
		<language>en</language>
		<source>https://github.com/ReichiMD/Stalker-vod-Client-tmdb</source>
		<website>https://github.com/ReichiMD/Stalker-vod-Client-tmdb</website>
		<assets>
			<icon>resources/media/icon.png</icon>
			<screenshot>resources/media/screenshot_1.png</screenshot>
			<screenshot>resources/media/screenshot_2.png</screenshot>
			<screenshot>resources/media/screenshot_3.png</screenshot>
			<screenshot>resources/media/screenshot_4.png</screenshot>
		</assets>
		<news>
v0.2.0  (2026-02-20)
- Fix: Einstellungsänderungen werden jetzt sofort wirksam ohne Kodi-Neustart.
  Ursache: Da reuselanguageinvoker=true aktiv ist, wurde der Python-Prozess
  wiederverwendet und Einstellungen nur beim ersten Aufruf gelesen. Alle
  getSetting()-Aufrufe in init_globals() werden nun bei jeder Navigation neu
  ausgeführt. Betroffen waren: TMDB an/aus, API-Key, Sprache, Poster/Fanart-
  Toggles, Cache-Einstellungen, Ordner-Filter, Portal-Adresse u.a.

v0.1.9  (2026-02-19)
- New: "What to show" group in the TMDB tab with five toggles to control
  which TMDB fields are applied to each film:
  • Poster (use TMDB cover instead of server cover)
  • Background image (Fanart)
  • Description (Plot)
  • Rating (e.g. ★ 7.4)
  • Genre names (e.g. Action, Comedy)
  All five are enabled by default. Turning off Fanart saves storage in
  Kodi's image cache; turning off individual fields has no effect on
  TMDB download speed (data is always fetched in one request).

v0.1.8  (2026-02-19)
- New button "Load TMDB metadata now" in the TMDB tab: fetches TMDB data
  for all films already in the local Stalker cache – without re-downloading
  Stalker data. Films already in the TMDB cache are skipped. Runs with a
  cancellable progress dialog. Stops safely on rate-limit errors.
- New button "Delete TMDB cache" in the TMDB tab: removes all locally
  stored TMDB metadata. Data is re-fetched the next time a folder is opened.

v0.1.7  (2026-02-19)
- New setting "Cache validity (days)" in the TMDB tab: configure how long
  TMDB metadata is kept before it is re-downloaded (default: 30 days).
  Higher values (e.g. 90 or 180) mean fewer downloads; lower values keep
  data more up-to-date. Range: 1–365 days.
- New button "Show cache info" in the TMDB tab: displays a dialog with
  number of stored films, age of newest/oldest entry, days remaining until
  the oldest entry expires, and the cache file size on disk.

v0.1.6  (2026-02-19)
- New: TMDB rate limiting (max 35 requests / 10 seconds) to stay safely
  below TMDB's published limit of 40 req/10s. Kodi no longer floods TMDB
  during bulk operations. A short automatic pause is inserted when needed.
- New: Hard abort after 3 consecutive HTTP 429 "Too Many Requests" errors.
  When TMDB repeatedly blocks requests, the download stops immediately and
  a clear dialog is shown: "TMDB hat zu viele Anfragen blockiert – bitte
  warte einige Minuten und versuche es erneut." Already downloaded data
  is saved before stopping.
- New: Genre names are now fetched from TMDB and shown in the Kodi info
  popup (e.g. "Action", "Komödie"). The genre list is downloaded once and
  cached for 30 days – no extra API call per film.
- Improvement: TMDB request timeout reduced from 10 s to 5 s. If TMDB is
  slow or unreachable, Kodi now recovers within 5 s instead of 10 s.
- Improvement: After a rate-limit abort during normal browsing, a small
  warning toast is shown once ("TMDB-Limit erreicht – Metadaten pausiert").
  Existing cached data is still shown; only uncached films lose TMDB data.

v0.1.5  (2026-02-19)
- New: Dedicated "Cache" settings section with 4 options:
  • "Use local cache" toggle (on by default) – disable to always fetch
    live from server (no local storage).
  • "Load all pages at once" moved here from Portal section.
  • "Refresh all data" – delete cache and reload everything (as before).
  • "Add new content only" – delta update: keep existing data, only
    fetch new films from server and add them to the cache. TMDB metadata
    is loaded only for new films. Runs with a progress dialog.
- Behaviour summary:
    Cache OFF + Load all = OFF → paginated from server (~20/page)
    Cache OFF + Load all = ON  → all pages from server (slower)
    Cache ON  + Load all = OFF → paginated from server (~20/page)
    Cache ON  + Load all = ON  → all films instantly from cache ✓

v0.1.4  (2026-02-19)
- Fix: "Alle Seiten laden" now works correctly together with the cache.
  OFF (default) = Variant 1: server pagination, ~20 films per page with
  Next/Previous buttons. Fast single pages from the server.
  ON = Variant 2: all films at once – instantly from cache if available,
  otherwise fetches all pages from server on first load.

v0.1.3  (2026-02-19)
- Fix: "Alle Seiten laden" (load_all_pages) setting works again.
  When enabled the cache is bypassed and all pages are fetched fresh
  directly from the server – so the setting has a clear effect again.
  When disabled (default) the local cache is used for fast browsing.

v0.1.2  (2026-02-19)
- New: Local Stalker data cache (24 h). Category lists and all video
  lists per folder are now saved to disk after the first load.
  Opening a folder for the second time is instant (no server request).
- New: Daily auto-refresh on Kodi start. The background service checks
  if the cache is older than 24 hours and silently refreshes it in the
  background – no dialog, no interruption.
- Improvement: "Alle Daten aktualisieren" now saves Stalker video lists
  to the local cache even when TMDB is disabled. The refresh is no
  longer a no-op without TMDB.

v0.1.1  (2026-02-19)
- Fix: keyword folder filter now uses word-boundary matching instead of
  plain substring search. Previously the keyword "de" accidentally matched
  folders like "nl-videoland" (because "de" appears inside "videoland").
  With word boundaries (\b) "de" only matches as a standalone word, e.g.
  "DE - Filme" or "de-action", but never inside "videoland".

v0.1.0  (2026-02-19)
- Improvement: Search no longer asks which group to search in.
  Clicking "VOD SEARCH" (or "SERIES SEARCH") directly opens the
  keyboard – the search always runs across all visible (filtered)
  folders automatically.
  Context-menu search on a specific folder still searches only
  that folder, as before.

v0.0.9  (2026-02-19)
- Fix: Search category dialog now shows only visible (filtered) folders.
  Hidden folders (blocked by keyword or manual filter) no longer appear
  in the search group selection popup.
- New: "Alle Kategorien" is the first and default option in the search
  group dialog – just confirm to search across all visible folders.
- Fix: "Alle Kategorien" search now only queries folders that pass the
  active folder filter. Result: no more content from hidden language
  groups (e.g. Turkish, English) when keyword filter is active.
  Searches each visible folder individually and combines results.

v0.0.8  (2026-02-19)
- Fix: folder filter mode selector replaced. type="integer" with spinner
  and labeled options is not valid in Kodi 21 settings version="1" (missing
  "format" attribute causes setting to be silently dropped, filter stays off).
  Replaced with two type="boolean" toggles: "Stichwörter-Filter aktiv"
  and "Manuelle Auswahl aktiv". Manual selection takes priority when
  both are enabled. Same approach as the type="action" fix in v0.0.5.

v0.0.7  (2026-02-19)
- Fix: "Alle Daten aktualisieren" respects the folder filter now.
  Only folders that pass the active filter (keywords or manual selection)
  are refreshed – skipping hidden folders saves significant time.

v0.0.6  (2026-02-19)
- New: "Ordner-Filter" settings section to hide unwanted folders.
  Three modes: Off (show all), Keywords (show folders whose name contains
  any of the listed words, e.g. "de, deutsch, german, multi"), and
  Manual selection (open a checklist and tick exactly which folders appear).
  Works for VOD, Series and TV genres independently.
- Filter runs immediately after the fast category API call – no extra
  loading time, TMDB is never involved at this stage.

v0.0.5  (2026-02-19)
- Fix: "Data management" group was invisible in Kodi settings. Root cause:
  type="action" with <action>RunPlugin()</action> is not valid in Kodi 21
  settings format version="1". The refresh trigger is now a boolean toggle
  that resets itself automatically after the service runs the refresh.

v0.0.4  (2026-02-19)
- Initial setup wizard: after entering server address and MAC address the
  addon automatically asks to pre-fetch all VOD data (Yes/No dialog).
  Runs only once; can be re-triggered via the "Refresh all data" button.
- German UI: full German translation added (resource.language.de_de).
  Kodi automatically uses it when the interface language is set to German.
- Settings: fixed duplicate group/setting label for "Load all pages".
  The data management group now has its own label ("Datenverwaltung").

v0.0.3  (2026-02-19)
- New setting "Load all pages at once": fetches all server pages in one
  listing call instead of paginating (TiviMate-style). Recommended when
  TMDB is disabled for fast full-category browsing.
- New button "Refresh all data": pre-fetches every VOD and Series category
  with a progress dialog. Warms the TMDB cache so all subsequent browsing
  is instant. Cancellable at any time.
- TMDB API key is preserved when TMDB is disabled (only greyed out in UI).

v0.0.2  (2026-02-18)
- Performance: TmdbClient is now a singleton per plugin run – cache file
  is loaded from disk once instead of once per list item.
- Performance: TMDB cache writes are now batched – one disk write per
  listing page instead of one per film.

v0.0.1  (2026-02-18)
- Fork of plugin.video.stalkervod v1.2.0 by rickeylohia (GPL-3.0)
- Added TMDB metadata integration: posters, fanart, plot and ratings
  for VOD and Series listings via The Movie Database API.
- New settings tab: TMDB API key, language and enable/disable toggle.
- Results cached locally (30-day expiry) to minimise API calls.
- Sets tmdb unique ID on ListItems for TMDb Helper addon compatibility.
		</news>
	</extension>
</addon>
